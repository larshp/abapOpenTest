import {REST} from './rest.js';
import {Router} from './router.js';

export const base = '/sap/zabapopentest';

export class StartPage {
  renderList(list) {
    let result = "";
    for(let project of list) {
      result = result + 
        "<div>" + 
        "Name: " + Router.link("projects/" + project.NAME, project.NAME) + "<br>" +
        "Package: " + project.DEVCLASS +
        "</div>"
    }
    if(list.length === 0) {
      alert("project list empty");
    }
    return result;
  }

  render() {
    return "<h1>abapOpenTest</h1>" + 
      REST.listProjects(this.renderList) + 
      "<br><a href=\"" + base + "/rest/swagger.html\">swagger</a>";
  }
}

export class NotFoundPage {
  render() {
    return "NotFoundPage<h1>404</h1>";
  }
}

export class RunDetailsPage {
  constructor(project, run) {
    this.project = project;
    this.run = run;
  }

  render() {
    return "<h1>"+this.project+" - Run #"+this.run+"</h1>"+
      "run details page, todo";
  }
}

export class ProjectPage {
  constructor(name) {
    this.name = name;
  }

  renderDetails(details) {
    return "Package: " + details.DEVCLASS + "<br>";
  }

  renderRuns(list) {
    let result = "List:<br>";

    for(let run of list) {
      result = result + 
        Router.link("projects/"+this.name+"/runs/"+run.RUN_NAME,"Run #" + run.RUN_NAME) + " " + 
        run.START_TIME + " " + 
        run.TESTS_SUCCESS + " " + 
        run.TESTS_FAILED + "<br>";
    }

    if (list.length === 0) {
      result = result + "empty";
    }

    return result;
  }

  render() {
    return "<h1>" + this.name + "</h1>" + 
      REST.projectDetails(this.name, this.renderDetails) + "<br>" +
      REST.listRuns(this.name, this.renderRuns.bind(this)) + "<br>" +
      "todo, latest runs, things changed<br>"+
      "todo, graph";
  }
}

Router.initialize();
Router.run();