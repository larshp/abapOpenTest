class ZCL_AOT_SERVICE_REST definition
  public
  create public .

public section.

  interfaces ZIF_AOT_SERVICE .
  interfaces ZIF_SWAG_HANDLER .

  methods LIST
    importing
      !IV_PACKAGE type DEVCLASS
    returning
      value(RT_CLASSES) type ZCL_AOT_BACKEND=>TY_CLASSES .
  methods RUN
    importing
      !IV_CLASS type SEOCLSNAME
    returning
      value(RS_RESULT) type ZCL_AOT_BACKEND=>TY_TEST_RESULT .
protected section.

  constants C_BASE type STRING value '/sap/zabapopentest/rest' ##NO_TEXT.
private section.
ENDCLASS.



CLASS ZCL_AOT_SERVICE_REST IMPLEMENTATION.


  METHOD list.

    rt_classes = zcl_aot_backend=>list_classes( to_upper( iv_package ) ).

  ENDMETHOD.


  METHOD run.

    rs_result = zcl_aot_backend=>run_test( iv_class ).

  ENDMETHOD.


  METHOD zif_aot_service~run.

    DATA: lo_swag TYPE REF TO zcl_swag.


    CREATE OBJECT lo_swag
      EXPORTING
        ii_server = ii_server
        iv_base   = c_base
        iv_title  = 'abapOpenTest'.
    lo_swag->register( me ).

    lo_swag->run( ).

  ENDMETHOD.


  METHOD zif_swag_handler~meta.

    FIELD-SYMBOLS: <ls_meta> LIKE LINE OF rt_meta.

    APPEND INITIAL LINE TO rt_meta ASSIGNING <ls_meta>.
    <ls_meta>-summary   = 'List Classes'(001).
    <ls_meta>-url-regex = '/list$'.
    <ls_meta>-method    = zcl_swag=>c_method-get.
    <ls_meta>-handler   = 'LIST'.

    APPEND INITIAL LINE TO rt_meta ASSIGNING <ls_meta>.
    <ls_meta>-summary   = 'Run Test'(002).
    <ls_meta>-url-regex = '/run$'.
    <ls_meta>-method    = zcl_swag=>c_method-post.
    <ls_meta>-handler   = 'RUN'.

  ENDMETHOD.
ENDCLASS.
