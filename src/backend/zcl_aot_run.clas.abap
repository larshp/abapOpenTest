class ZCL_AOT_RUN definition
  public
  create private .

public section.

  methods APPEND_OBJECT
    importing
      !IS_OBJECT type ZAOT_OBJECTS .
  methods APPEND_TEST
    importing
      !IS_TEST type ZAOT_TESTS .
  methods SAVE .
  class-methods CREATE
    importing
      !IO_PROJECT type ref to ZCL_AOT_PROJECT
    returning
      value(RO_RUN) type ref to ZCL_AOT_RUN .
  methods SET_START_TIME .
  methods SET_END_TIME .
protected section.
private section.

  data MS_RUN type ZAOT_RUNS .
  data MT_TESTS type ZAOT_TESTS_TT .
  data MT_OBJECTS type ZAOT_OBJECTS_TT .
ENDCLASS.



CLASS ZCL_AOT_RUN IMPLEMENTATION.


  METHOD append_object.

    ASSERT is_object-run_id IS INITIAL.
    ASSERT NOT is_object-object_name IS INITIAL.
    ASSERT NOT is_object-object_type IS INITIAL.

    DATA(ls_object) = is_object.
    ls_object-run_id = ms_run-run_id.

    APPEND ls_object TO mt_objects.

  ENDMETHOD.


  METHOD append_test.

    ASSERT NOT is_test-program_name IS INITIAL.
    ASSERT NOT is_test-class_name IS INITIAL.
    ASSERT NOT is_test-method_name IS INITIAL.
    ASSERT NOT is_test-object_name IS INITIAL.
    ASSERT NOT is_test-object_type IS INITIAL.

    DATA(ls_test) = is_test.
    ls_test-run_id = ms_run-run_id.

    APPEND ls_test TO mt_tests.

  ENDMETHOD.


  METHOD create.

    CREATE OBJECT ro_run.
    ro_run->ms_run-project = io_project->get_details( )-project.

    TRY.
        ro_run->ms_run-run_id = cl_system_uuid=>create_uuid_x16_static( ).
      CATCH cx_uuid_error.
        ASSERT 0 = 1.
    ENDTRY.

  ENDMETHOD.


  METHOD save.

    INSERT zaot_runs FROM ms_run.
    ASSERT sy-subrc = 0.

    INSERT zaot_objects FROM TABLE mt_objects.

    INSERT zaot_tests FROM TABLE mt_tests.

  ENDMETHOD.


  METHOD set_end_time.

    GET TIME STAMP FIELD ms_run-end_time.

  ENDMETHOD.


  METHOD set_start_time.

    GET TIME STAMP FIELD ms_run-start_time.

  ENDMETHOD.
ENDCLASS.
